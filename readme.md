# Программа для вычисления точки пересечения между двумя сегмента в 3-хмерном пространстве.

Изначально код написан под внедрение в проект С++ (без Qt). Оболочка Qt используется только для отладки и создания пользовательского интерфейса для удобства работы и отладки.

## Краткое описание действия программы
Краткая блок-схема проверок лежит в файле [*block_diagram.pdf*](block_diagram.pdf).

Первым делом программа определяет лежат ли сегменты в одной плоскости. Если не лежат то точки пересечения не существует.

Если сегменты лежат в одной плоскости, то происходит проверка, не являются ли сегменты 
(а точнее соответствующие направляющие вектора) коллинеарными. 
Если сегменты коллинеарны, то проверяется, нет ли сегментов нулевой длины. Если хотя бы один такой существует, то проверяется, не принадлежит ли эта "точка" другому сегменту.

### Вычисление для общего случая (если сегменты не коллинеарны)

Рисунок есть в [*block_diagram.pdf*](block_diagram.pdf).

Вектор **BP**, где **P** - точка пересечения сегментов, можно записать следующим образом:

**BP = u * BA**, причём **u** это скаляр из *[0, 1]*. Если *u* не принадлежит отрезку *[0, 1]*, то точка **P** будет лежать вне сегмента **BA**.

Следующими простыми преобразованиями можно получить (**O** - начало системы координат):

**BO * OP = U * (BO + OA)**

**OP = u * OA + (u - 1) * BO = u * OA + (1 - u) * OB**

Аналогично можно получить:

**OP = v * OC + (1 - v) * OD**, где *v* — некоторый скаляр из отрезка *[0, 1]*.

Приравнивая левые части уравнений, получаем:

**u * BA + v * CD = BD**

Это является системой из 3-х уравнений с 2 неизвестными. Однако необязательно вычислять учитывать одно из уравнений, т.к. уже проверено, что сегменты лежат в одной плоскости.
Среди получившихся уравнений, выбираются те, которые имеют невырожденную матрицу. В программе выбираются те координаты, для которых модуль определителя наибольший. 

После вычисления коэффициентов *u*, *v* проверяются их принадлежность к отрезку *[0, 1].
Если оба коэффициента принадлежат отрезку [0, 1] это означает, что точка пересечения внутри сегментов. 
Если хотя бы один из коэффициентов не принадлежит отрезку [0, 1], то это значит, что точка пересечения не лежит хотя бы на одном из сегментов.

Итоговый ответ это точка:

**P = u * BA + B = (u * (x_A - x_B) + x_B, u * (y_A - y_B) + y_B, u * (z_A - z_B) + z_B)**

## Last update

Последние изменения были направлены на переход в векторную геометрию, а точнее внутренний переход кода программы от вычисления координат к вычислению векторов.

### Известные ошибки:
- Note1. Если сегменты коллинеарны и к тому же лежат на одной прямой, то необходимо проводить дополнительные проверки - возможно, что точек пересечения не существует, существует только одна или существует бесконечное множество точек пересечения. (*исправлено*)
---

### Используемые инcтрументы
* Qt 5.15.2 x64
* MinGW 8.1.0
* CMake v3.30.5
